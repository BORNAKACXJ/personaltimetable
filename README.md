# Hit the City - Personal Timetable

A React-based festival timetable application that connects to Supabase to display festival days, times, acts, and artist information.

## Features

- **Cached Data**: Festival data is cached for better performance
- **Responsive Design**: Works on desktop and mobile devices
- **Multiple Views**: Timeline and list view for different ways to browse acts
- **Artist Information**: Detailed artist profiles and information
- **Day Navigation**: Easy switching between festival days
- **API Endpoints**: Normal and time-slots API for data access
- **Cache Management**: View and manage cached data
- **Spotify Integration**: Connect your Spotify account for personalized recommendations
- **Personal Timetable**: Get recommendations based on your listening history

## Tech Stack

- **Frontend**: React 18 with Vite
- **Database**: Supabase (PostgreSQL)
- **Styling**: Custom CSS with existing design system
- **Icons**: Font Awesome
- **Music API**: Spotify Web API

## Database Schema

The application expects the following tables in your Supabase database:

### `festival_days`
- `id` (int, primary key)
- `name` (text) - e.g., "Friday 29 Augustus"
- `date` (date) - e.g., "2025-08-29"

### `times`
- `id` (int, primary key)
- `time` (time) - e.g., "14:00:00"

### `acts`
- `id` (int, primary key)
- `name` (text) - act name
- `start_time` (time) - start time
- `end_time` (time) - end time
- `stage_name` (text) - stage name
- `festival_day_id` (int, foreign key to festival_days.id)
- `artist_id` (int, foreign key to artists.id)

### `artists`
- `id` (uuid, primary key)
- `name` (text) - artist name
- `spotify_id` (text) - Spotify artist ID
- `image_url` (text) - artist image URL
- `spotify_url` (text) - Spotify profile URL
- `genres` (text[]) - music genres
- `popularity` (integer) - Spotify popularity score
- `followers` (integer) - number of followers
- `about` (text) - artist description

### `related_artists`
- `id` (uuid, primary key)
- `artist_id` (uuid, foreign key to artists.id)
- `related_spotify_id` (text) - Spotify ID of related artist
- `related_artist_name` (text) - name of related artist
- `similarity_score` (numeric) - similarity score between artists

## Environment Variables

Create a `.env` file in the root directory with your Supabase and Spotify credentials:

```env
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
VITE_SUPABASE_URL=your_supabase_url
VITE_SPOTIFY_CLIENT_ID=your_spotify_client_id
VITE_SPOTIFY_CLIENT_SECRET=your_spotify_client_secret
VITE_SPOTIFY_REDIRECT_URI=http://localhost:5173/callback
```

## Getting Started

1. **Install dependencies**:
   ```bash
   npm install
   ```

2. **Set up environment variables**:
   Create a `.env` file with your Supabase credentials

3. **Start the development server**:
   ```bash
   npm run dev
   ```

4. **Build for production**:
   ```bash
   npm run build
   ```

## Project Structure

```
src/
├── hooks/
│   ├── useFestivalData.js           # Custom hook for fetching festival data
│   ├── useCachedFestivalData.js    # Custom hook for cached festival data
│   ├── useSpotifyAuth.js           # Spotify authentication and data fetching
│   └── useSpotifyRecommendations.js # Spotify recommendation logic
├── lib/
│   └── supabase.js                  # Supabase client configuration
├── pages/
│   ├── Api.jsx                      # API page with normal and time-slots endpoints
│   └── Cache.jsx                    # Cache management page
├── components/
│   ├── ArtistDialog.jsx             # Artist information dialog
│   ├── TimelineView.jsx             # Timeline view component
│   └── SpotifyCallback.jsx          # Spotify OAuth callback handler
├── App.jsx                          # Main application component
└── App.css                          # Additional styles

public/
└── _assets/                         # Static assets (CSS, images, fonts)
    ├── main.css
    ├── timetable.css
    ├── artist--dialog.css
    └── _images/
        └── logo-hitthecity.png
```

## Development

The application uses React hooks to manage state and fetch data from Supabase. The main data flow is:

1. `useCachedFestivalData` hook fetches and caches data from Supabase
2. Data is processed and grouped by day and stage
3. Components render the data in either timeline or list view
4. Users can switch between days and views
5. Cache is automatically refreshed every 5 minutes

## Spotify Integration

The application integrates with Spotify to provide personalized recommendations:

1. Users connect their Spotify account via OAuth
2. The app fetches user's top artists and tracks
3. Recommendations are generated by matching user's artists with festival artists
4. Direct matches and related artists (from `related_artists` table) are highlighted
5. Recommended acts are visually distinguished with green styling and ★ badges

## Navigation

- **Main Page** (`/`): Displays the festival timetable with cached data and Spotify recommendations
- **API Page** (`/api`): Shows both normal and time-slots API endpoints
- **Cache Page** (`/cache`): Manage cache, view cache status, and refresh data
- **Callback** (`/callback`): Handles Spotify OAuth callback

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This project is licensed under the MIT License.
